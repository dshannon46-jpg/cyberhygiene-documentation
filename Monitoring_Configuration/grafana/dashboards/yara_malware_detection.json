{
  "title": "YARA Malware Detection",
  "tags": ["security", "yara", "malware", "wazuh"],
  "timezone": "browser",
  "editable": true,
  "graphTooltip": 0,
  "schemaVersion": 38,
  "version": 1,
  "refresh": "30s",
  "time": {
    "from": "now-24h",
    "to": "now"
  },
  "panels": [
    {
      "id": 1,
      "gridPos": {"h": 6, "w": 12, "x": 0, "y": 0},
      "type": "timeseries",
      "title": "YARA Detections Over Time",
      "targets": [{
        "datasource": {"type": "elasticsearch", "uid": "elasticsearch-graylog"},
        "refId": "A",
        "query": "yara_rule_name:* OR message:*YARA_DETECTION*",
        "metrics": [{"type": "count", "id": "1"}],
        "bucketAggs": [{
          "type": "date_histogram",
          "id": "2",
          "settings": {"interval": "auto", "min_doc_count": "0"},
          "field": "timestamp"
        }],
        "timeField": "timestamp"
      }],
      "options": {
        "tooltip": {"mode": "multi"},
        "legend": {"displayMode": "list", "placement": "bottom"}
      },
      "fieldConfig": {
        "defaults": {
          "custom": {"drawStyle": "line", "fillOpacity": 20},
          "color": {"mode": "palette-classic"}
        }
      }
    },
    {
      "id": 2,
      "gridPos": {"h": 6, "w": 6, "x": 12, "y": 0},
      "type": "stat",
      "title": "Total YARA Detections (24h)",
      "targets": [{
        "datasource": {"type": "elasticsearch", "uid": "elasticsearch-graylog"},
        "refId": "A",
        "query": "yara_rule_name:* OR message:*YARA_DETECTION*",
        "metrics": [{"type": "count", "id": "1"}],
        "timeField": "timestamp"
      }],
      "options": {
        "graphMode": "area",
        "colorMode": "value",
        "textMode": "auto"
      },
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 5},
              {"color": "red", "value": 20}
            ]
          }
        }
      }
    },
    {
      "id": 3,
      "gridPos": {"h": 6, "w": 6, "x": 18, "y": 0},
      "type": "stat",
      "title": "Critical Detections",
      "targets": [{
        "datasource": {"type": "elasticsearch", "uid": "elasticsearch-graylog"},
        "refId": "A",
        "query": "yara_severity:critical OR (message:*YARA_DETECTION* AND message:*critical*)",
        "metrics": [{"type": "count", "id": "1"}],
        "timeField": "timestamp"
      }],
      "options": {
        "graphMode": "area",
        "colorMode": "background"
      },
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {
            "steps": [
              {"color": "green", "value": null},
              {"color": "orange", "value": 1},
              {"color": "red", "value": 5}
            ]
          }
        }
      }
    },
    {
      "id": 4,
      "gridPos": {"h": 8, "w": 24, "x": 0, "y": 6},
      "type": "table",
      "title": "Recent YARA Detections",
      "targets": [{
        "datasource": {"type": "elasticsearch", "uid": "elasticsearch-graylog"},
        "refId": "A",
        "query": "yara_rule_name:* OR message:*YARA_DETECTION*",
        "metrics": [{"type": "raw_document", "id": "1"}],
        "timeField": "timestamp",
        "bucketAggs": []
      }],
      "transformations": [{
        "id": "organize",
        "options": {
          "excludeByName": {"_id": true, "_index": true, "_type": true},
          "indexByName": {
            "timestamp": 0,
            "yara_rule_name": 1,
            "yara_severity": 2,
            "yara_file_path": 3,
            "yara_file_hash": 4,
            "source": 5
          },
          "renameByName": {
            "timestamp": "Time",
            "yara_rule_name": "Malware",
            "yara_severity": "Severity",
            "yara_file_path": "File Path",
            "yara_file_hash": "Hash",
            "source": "Host"
          }
        }
      }],
      "fieldConfig": {
        "defaults": {"custom": {"filterable": true}},
        "overrides": [{
          "matcher": {"id": "byName", "options": "Severity"},
          "properties": [{
            "id": "custom.cellOptions",
            "value": {"type": "color-background"}
          }]
        }]
      },
      "options": {
        "showHeader": true,
        "sortBy": [{"displayName": "Time", "desc": true}]
      }
    }
  ],
  "templating": {"list": []},
  "annotations": {"list": []},
  "uid": "yara-malware-detection",
  "style": "dark"
}
